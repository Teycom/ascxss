<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Avaliacao Medica | MedDigital</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; min-height: 100vh; color: #1e293b; }
    .container { width: 100%; max-width: 480px; margin: 0 auto; padding: 0 16px; }
    
    .header { background: linear-gradient(135deg, #059669 0%, #0891b2 100%); padding: 16px 0; position: sticky; top: 0; z-index: 100; }
    .header-content { display: flex; align-items: center; justify-content: space-between; }
    .brand { display: flex; align-items: center; gap: 10px; color: white; font-weight: 800; font-size: 18px; }
    
    .progress-wrapper { background: white; padding: 16px 0; border-bottom: 1px solid #e2e8f0; }
    .progress-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #10b981 0%, #06b6d4 100%); border-radius: 4px; transition: width 0.5s ease; width: 20%; }
    
    .quiz-container { padding: 20px 0 40px; }
    .step-card { background: white; border-radius: 20px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 20px; border: 1px solid #f1f5f9; }
    .step-title { font-size: 20px; font-weight: 700; color: #0f172a; margin-bottom: 8px; }
    .step-subtitle { font-size: 14px; color: #64748b; margin-bottom: 20px; }
    
    .options-list { display: flex; flex-direction: column; gap: 12px; }
    .option-item { display: flex; align-items: center; gap: 14px; padding: 16px; background: white; border: 2px solid #e2e8f0; border-radius: 16px; cursor: pointer; transition: all 0.2s ease; }
    .option-item:hover { border-color: #10b981; transform: translateY(-2px); }
    .option-item.selected { border-color: #10b981; background: #ecfdf5; }
    .option-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
    .option-content { flex: 1; }
    .option-title { font-weight: 600; font-size: 15px; color: #1e293b; }
    .option-check { width: 28px; height: 28px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transform: scale(0); transition: all 0.2s ease; }
    .option-item.selected .option-check { opacity: 1; transform: scale(1); }
    
    .input-field { width: 100%; padding: 16px; font-size: 16px; border: 2px solid #e2e8f0; border-radius: 16px; transition: all 0.2s ease; font-family: inherit; }
    .input-field:focus { outline: none; border-color: #10b981; }
    
    .btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 16px 24px; font-size: 16px; font-weight: 700; border: none; border-radius: 16px; cursor: pointer; transition: all 0.2s ease; margin-top: 16px; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-2px); }
    
    .signature-canvas { width: 100%; height: 200px; background: white; border: 2px dashed #cbd5e1; border-radius: 12px; cursor: crosshair; touch-action: none; }
    
    .hidden { display: none !important; }
    
    /* LOADING */
    .loading-overlay { 
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      display: none; flex-direction: column; align-items: center; justify-content: center;
      z-index: 1000; padding: 20px;
    }
    .loading-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 24px;
      padding: 40px 32px;
      width: 100%; max-width: 380px;
      text-align: center;
    }
    .loading-icon {
      width: 80px; height: 80px;
      background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
      border-radius: 20px;
      display: flex; align-items: center; justify-content: center;
      font-size: 40px; margin: 0 auto 24px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
      50% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
    }
    .loading-title { color: white; font-size: 22px; font-weight: 700; margin-bottom: 8px; }
    .loading-subtitle { color: #94a3b8; font-size: 14px; margin-bottom: 32px; }
    .loading-progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
    .loading-progress-fill { height: 100%; background: linear-gradient(90deg, #10b981 0%, #06b6d4 100%); border-radius: 4px; width: 0%; transition: width 0.3s ease; }
    .loading-percentage { color: #10b981; font-size: 18px; font-weight: 700; margin-bottom: 8px; }
    .loading-status { color: #94a3b8; font-size: 14px; }
    
    .alert { padding: 16px; border-radius: 12px; margin-top: 16px; display: none; }
    .alert-info { background: #eff6ff; border-left: 4px solid #3b82f6; color: #1e40af; }
    
    .checkbox-item { display: flex; align-items: flex-start; gap: 12px; padding: 16px; background: white; border: 2px solid #e2e8f0; border-radius: 16px; cursor: pointer; }
    .checkbox-item.selected { border-color: #10b981; background: #ecfdf5; }
    .checkbox-box { width: 24px; height: 24px; border: 2px solid #cbd5e1; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
    .checkbox-item.selected .checkbox-box { background: #10b981; border-color: #10b981; color: white; }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div class="brand">
          <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">üè•</div>
          <span>MedDigital</span>
        </div>
      </div>
    </div>
  </header>

  <div class="progress-wrapper">
    <div class="container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
  </div>

  <main class="quiz-container">
    <div class="container">
      
      <!-- STEP 1: Sintoma -->
      <div class="step-card" id="step-1">
        <h2 class="step-title">Qual sintoma est√° dominando seu corpo AGORA?</h2>
        <p class="step-subtitle">Selecione o sintoma mais intenso</p>
        <div class="options-list">
          <div class="option-item" onclick="selectOption(1, 'gripe', 'Gripe/Febre')">
            <div class="option-icon" style="background: #fef3c7;">ü§í</div>
            <div class="option-content"><div class="option-title">Gripe / Febre / Fraqueza</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(1, 'dor', 'Dor Muscular')">
            <div class="option-icon" style="background: #fce7f3;">üí™</div>
            <div class="option-content"><div class="option-title">Dor Muscular / Articular</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(1, 'cabeca', 'Enxaqueca')">
            <div class="option-icon" style="background: #dbeafe;">üß†</div>
            <div class="option-content"><div class="option-title">Enxaqueca / Tontura</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(1, 'estomago', 'Mal-estar')">
            <div class="option-icon" style="background: #d1fae5;">ü§¢</div>
            <div class="option-content"><div class="option-title">Mal-estar G√°strico</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(1, 'ansiedade', 'Ansiedade')">
            <div class="option-icon" style="background: #f3e8ff;">üí≠</div>
            <div class="option-content"><div class="option-title">Crise de Ansiedade</div></div>
            <div class="option-check">‚úì</div>
          </div>
        </div>
        <div class="alert alert-info" id="alert-sintoma"></div>
      </div>

      <!-- STEP 2: Tempo -->
      <div class="step-card hidden" id="step-2">
        <h2 class="step-title">H√° quanto tempo seu organismo pede socorro?</h2>
        <div class="options-list">
          <div class="option-item" onclick="selectOption(2, 'hoje', 'Hoje')">
            <div class="option-icon" style="background: #fef3c7;">‚è∞</div>
            <div class="option-content"><div class="option-title">Come√ßou hoje</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(2, 'ontem', 'Ontem')">
            <div class="option-icon" style="background: #fce7f3;">üìÖ</div>
            <div class="option-content"><div class="option-title">Desde ontem</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(2, '48h', '48h')">
            <div class="option-icon" style="background: #fee2e2;">‚ö†Ô∏è</div>
            <div class="option-content"><div class="option-title">Mais de 48 horas</div></div>
            <div class="option-check">‚úì</div>
          </div>
        </div>
      </div>

      <!-- STEP 3: Dor -->
      <div class="step-card hidden" id="step-3">
        <h2 class="step-title">Em uma escala de 1 a 10, qual a intensidade?</h2>
        <div style="padding: 20px 0;">
          <input type="range" min="1" max="10" value="5" style="width: 100%;" id="painSlider" oninput="updatePain(this.value)">
          <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 13px; color: #64748b;">
            <span>Leve (1)</span><span>Moderado (5)</span><span>Intenso (10)</span>
          </div>
          <div style="text-align: center; margin-top: 20px; padding: 16px; background: #ecfdf5; border-radius: 12px; font-weight: 600; color: #059669;" id="painDisplay">N√≠vel 5: Desconforto significativo</div>
        </div>
        <button class="btn btn-primary" onclick="goToStep(4)">Continuar ‚Üí</button>
      </div>

      <!-- STEP 4: Alertas -->
      <div class="step-card hidden" id="step-4">
        <h2 class="step-title">Voc√™ apresenta algum desses sinais?</h2>
        <p class="step-subtitle">Marque todos que se aplicam</p>
        <div class="options-list">
          <label class="checkbox-item" onclick="toggleCheckbox(this, 'febre')">
            <div class="checkbox-box"></div>
            <div>Febre acima de 37,5¬∞C</div>
          </label>
          <label class="checkbox-item" onclick="toggleCheckbox(this, 'cama')">
            <div class="checkbox-box"></div>
            <div>Dificuldade para levantar da cama</div>
          </label>
          <label class="checkbox-item" onclick="toggleCheckbox(this, 'vomito')">
            <div class="checkbox-box"></div>
            <div>V√¥mitos ou n√°useas persistentes</div>
          </label>
        </div>
        <button class="btn btn-primary" onclick="goToStep(5)" style="margin-top: 20px;">Continuar ‚Üí</button>
      </div>

      <!-- STEP 5: Trabalho -->
      <div class="step-card hidden" id="step-5">
        <h2 class="step-title">Seu trabalho exige foco mental ou m√°quinas?</h2>
        <div class="options-list">
          <div class="option-item" onclick="selectOption(5, 'raciocinio', 'Foco mental')">
            <div class="option-icon" style="background: #dbeafe;">üß†</div>
            <div class="option-content"><div class="option-title">Preciso raciocinar claramente</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(5, 'maquinas', 'M√°quinas')">
            <div class="option-icon" style="background: #fee2e2;">‚öôÔ∏è</div>
            <div class="option-content"><div class="option-title">Opero m√°quinas/ve√≠culos</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(5, 'presenca', 'Presen√ßa')">
            <div class="option-icon" style="background: #d1fae5;">üë§</div>
            <div class="option-content"><div class="option-title">Presen√ßa, sem m√°quinas</div></div>
            <div class="option-check">‚úì</div>
          </div>
        </div>
      </div>

      <!-- STEP 6: Data -->
      <div class="step-card hidden" id="step-6">
        <h2 class="step-title">Voc√™ precisa justificar aus√™ncia para:</h2>
        <div class="options-list">
          <div class="option-item" onclick="selectOption(6, 'hoje', 'Hoje')">
            <div class="option-icon" style="background: #fecaca;">üî¥</div>
            <div class="option-content"><div class="option-title">Hoje (urgente)</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(6, 'amanha', 'Amanh√£')">
            <div class="option-icon" style="background: #fef3c7;">üü°</div>
            <div class="option-content"><div class="option-title">Amanh√£</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectOption(6, 'retroativo', 'Retroativo')">
            <div class="option-icon" style="background: #dbeafe;">üìÑ</div>
            <div class="option-content"><div class="option-title">Retroativo (ontem)</div></div>
            <div class="option-check">‚úì</div>
          </div>
        </div>
      </div>

      <!-- STEP 7: Nome -->
      <div class="step-card hidden" id="step-7">
        <h2 class="step-title">Qual seu nome completo?</h2>
        <p class="step-subtitle">Para o laudo oficial</p>
        <input type="text" class="input-field" id="nomeInput" placeholder="Ex: Jo√£o Silva Santos" oninput="updateNome(this.value)">
        <button class="btn btn-primary" onclick="goToStep(8)" id="btnNome" disabled>Continuar ‚Üí</button>
      </div>

      <!-- STEP 8: Email -->
      <div class="step-card hidden" id="step-8">
        <h2 class="step-title">Email para envio do documento</h2>
        <input type="email" class="input-field" id="emailInput" placeholder="seu@email.com" oninput="updateEmail(this.value)">
        <button class="btn btn-primary" onclick="goToStep(9)" id="btnEmail" disabled>Continuar ‚Üí</button>
      </div>

      <!-- STEP 9: Termos -->
      <div class="step-card hidden" id="step-9">
        <h2 class="step-title">Confirma√ß√£o de Veracidade</h2>
        <label class="checkbox-item" onclick="toggleConfirm(this)" style="padding: 20px;">
          <div class="checkbox-box"></div>
          <div>
            <div style="font-weight: 600; margin-bottom: 4px;">Confirmo a veracidade dos sintomas</div>
            <div style="font-size: 13px; color: #64748b;">Declaro que as informa√ß√µes s√£o verdadeiras</div>
          </div>
        </label>
        <button class="btn btn-primary" onclick="goToStep(10)" id="btnConfirm" disabled>Prosseguir ‚Üí</button>
      </div>

      <!-- STEP 10: Assinatura -->
      <div class="step-card hidden" id="step-10">
        <h2 class="step-title">Assinatura Digital</h2>
        <p class="step-subtitle">Toque e arraste para assinar</p>
        <canvas class="signature-canvas" id="signatureCanvas"></canvas>
        <button onclick="clearSignature()" style="background: none; border: none; color: #64748b; margin-top: 12px; text-decoration: underline;">Limpar</button>
        <button class="btn btn-primary" onclick="goToStep(11)" id="btnSignature" disabled>Confirmar ‚Üí</button>
      </div>

      <!-- STEP 11: Dias -->
      <div class="step-card hidden" id="step-11">
        <h2 class="step-title">A IA recomenda repouso. Voc√™ precisa de:</h2>
        <div class="options-list">
          <div class="option-item" onclick="selectDays(1)">
            <div class="option-icon" style="background: #fef3c7;">1Ô∏è‚É£</div>
            <div class="option-content"><div class="option-title">1 dia</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectDays(2)">
            <div class="option-icon" style="background: #fde68a;">2Ô∏è‚É£</div>
            <div class="option-content"><div class="option-title">2 dias</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectDays(7)">
            <div class="option-icon" style="background: #bfdbfe;">7Ô∏è‚É£</div>
            <div class="option-content"><div class="option-title">7 dias (1 semana)</div></div>
            <div class="option-check">‚úì</div>
          </div>
          <div class="option-item" onclick="selectDays(14)">
            <div class="option-icon" style="background: #ddd6fe;">üìÖ</div>
            <div class="option-content"><div class="option-title">14 dias (2 semanas)</div></div>
            <div class="option-check">‚úì</div>
          </div>
        </div>
      </div>

      <!-- STEP 12: Hospital -->
      <div class="step-card hidden" id="step-12">
        <h2 class="step-title">Selecione a unidade de sa√∫de</h2>
        <p class="step-subtitle">Hospital ou posto mais pr√≥ximo</p>
        
        <div id="hospitalLoading" style="text-align: center; padding: 30px; background: #f8fafc; border-radius: 16px; border: 2px dashed #e2e8f0;">
          <div style="font-size: 40px; animation: bounce 1s infinite;">üè•</div>
          <p style="font-weight: 600; margin-top: 12px;">Carregando hospitais...</p>
        </div>
        
        <div id="hospitalList" class="options-list hidden" style="margin-top: 16px;">
          <!-- Hospitais ser√£o inseridos aqui -->
        </div>
        
        <button class="btn btn-primary" onclick="goToResultado()" id="btnHospital" disabled>‚úì Gerar Atestado ‚Üí</button>
      </div>

    </div>
  </main>

  <!-- LOADING SCREEN -->
  <div class="loading-overlay" id="loadingScreen">
    <div class="loading-card">
      <div class="loading-icon">üè•</div>
      <h2 class="loading-title">Analisando suas respostas...</h2>
      <p class="loading-subtitle">Nossa IA m√©dica est√° processando</p>
      <div class="loading-progress-bar">
        <div class="loading-progress-fill" id="loadingProgress"></div>
      </div>
      <div class="loading-percentage" id="loadingPercentage">0%</div>
      <div class="loading-status" id="loadingStatus">Iniciando...</div>
    </div>
  </div>

  <script>
    // VARI√ÅVEIS GLOBAIS
    let currentStep = 1;
    let userData = { nome: '', email: '', sintoma: '', dias: 2, hospital: '' };
    let hasSigned = false;
    let canvas, ctx;
    
    // DADOS DOS HOSPITAIS
    const hospitalsDB = {
      'S√£o Paulo': ['Hospital das Cl√≠nicas - SP', 'Hospital S√≠rio-Liban√™s', 'UPA Pinheiros', 'Posto Sa√∫de Vila Madalena', 'Hospital Albert Einstein'],
      'Rio de Janeiro': ['Hospital Samaritano', 'Hospital Copa DOr', 'UPA Copacabana', 'Hospital Municipal Souza Aguiar'],
      'Belo Horizonte': ['Hospital das Cl√≠nicas UFMG', 'Hospital Sofia Feldman', 'UPA Barreiro'],
      'Bras√≠lia': ['Hospital de Base', 'Hospital Bras√≠lia', 'UPA Asa Sul'],
      'Curitiba': ['Hospital de Cl√≠nicas UFPR', 'Hospital Evang√©lico', 'UPA Boqueir√£o'],
      'Salvador': ['Hospital Roberto Santos', 'Hospital Portugu√™s', 'UPA Barra'],
      'Fortaleza': ['Hospital S√£o Mateus', 'Hospital Unimed', 'UPA Aldeota'],
      'Recife': ['Hospital Real Benefic√™ncia', 'Hospital Memorial', 'UPA Boa Viagem'],
      'Porto Alegre': ['HCPA', 'Hospital Moinhos de Vento', 'UPA Centro'],
      'Manaus': ['Hospital 28 de Agosto', 'HUGV', 'UPA Centro']
    };
    
    // INICIALIZA√á√ÉO
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Quiz iniciado');
      for (let i = 2; i <= 12; i++) {
        const step = document.getElementById('step-' + i);
        if (step) step.classList.add('hidden');
      }
      initCanvas();
    });
    
    // NAVEGA√á√ÉO
    function goToStep(stepNum) {
      console.log(' Indo para step:', stepNum);
      
      // Esconde atual
      const currentEl = document.getElementById('step-' + currentStep);
      if (currentEl) currentEl.classList.add('hidden');
      
      // Mostra pr√≥ximo
      const nextEl = document.getElementById('step-' + stepNum);
      if (nextEl) nextEl.classList.remove('hidden');
      
      currentStep = stepNum;
      updateProgress(stepNum);
      
      // Se for step 12, carrega hospitais
      if (stepNum === 12) {
        loadHospitals();
      }
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function updateProgress(step) {
      const fill = document.getElementById('progressFill');
      if (fill) fill.style.width = (step * 8) + '%';
    }
    
    // SELE√á√ÉO DE OP√á√ïES
    function selectOption(step, value, label) {
      console.log('Select:', step, value, label);
      
      if (step === 1) userData.sintoma = label;
      
      // Visual
      const stepEl = document.getElementById('step-' + step);
      const options = stepEl.querySelectorAll('.option-item');
      options.forEach(function(opt) { opt.classList.remove('selected'); });
      event.currentTarget.classList.add('selected');
      
      // Pr√≥ximo
      setTimeout(function() { goToStep(step + 1); }, 300);
    }
    
    // SLIDER DE DOR
    function updatePain(value) {
      const labels = ['', 'Leve', 'Moderado', 'Significativo', 'Intenso', 'Severo'];
      const display = document.getElementById('painDisplay');
      if (display) {
        display.textContent = 'N√≠vel ' + value + ': ' + (labels[Math.ceil(value/2)] || 'Significativo');
      }
    }
    
    // CHECKBOXES
    function toggleCheckbox(element, value) {
      element.classList.toggle('selected');
    }
    
    // INPUTS
    function updateNome(value) {
      userData.nome = value.trim();
      document.getElementById('btnNome').disabled = value.length < 5;
    }
    
    function updateEmail(value) {
      userData.email = value.trim();
      const valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
      document.getElementById('btnEmail').disabled = !valid;
    }
    
    function toggleConfirm(element) {
      element.classList.toggle('selected');
      document.getElementById('btnConfirm').disabled = !element.classList.contains('selected');
    }
    
    // ASSINATURA
    function initCanvas() {
      canvas = document.getElementById('signatureCanvas');
      if (!canvas) return;
      
      ctx = canvas.getContext('2d');
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2.5;
      ctx.lineCap = 'round';
      
      let drawing = false;
      
      canvas.addEventListener('mousedown', function(e) {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
      });
      
      canvas.addEventListener('mousemove', function(e) {
        if (!drawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        hasSigned = true;
        document.getElementById('btnSignature').disabled = false;
      });
      
      canvas.addEventListener('mouseup', function() { drawing = false; });
      canvas.addEventListener('mouseleave', function() { drawing = false; });
    }
    
    function clearSignature() {
      if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasSigned = false;
      document.getElementById('btnSignature').disabled = true;
    }
    
    // DIAS
    function selectDays(days) {
      userData.dias = days;
      
      // Visual
      const options = document.querySelectorAll('#step-11 .option-item');
      options.forEach(function(opt) { opt.classList.remove('selected'); });
      event.currentTarget.classList.add('selected');
      
      // Salva assinatura
      if (hasSigned && canvas) {
        localStorage.setItem('atestado_assinatura', canvas.toDataURL());
      }
      
      setTimeout(function() { goToStep(12); }, 300);
    }
    
    // HOSPITAIS - VERS√ÉO SIMPLES
    function loadHospitals() {
      console.log('Carregando hospitais...');
      
      const loading = document.getElementById('hospitalLoading');
      const list = document.getElementById('hospitalList');
      
      // Simula cidades com base no hor√°rio (apenas para demonstra√ß√£o)
      const cidades = Object.keys(hospitalsDB);
      const cidade = cidades[Math.floor(Math.random() * cidades.length)];
      const hospitais = hospitalsDB[cidade] || hospitalsDB['S√£o Paulo'];
      
      // Esconde loading
      loading.classList.add('hidden');
      list.classList.remove('hidden');
      
      // Gera lista
      list.innerHTML = '';
      hospitais.forEach(function(hosp, index) {
        const div = document.createElement('div');
        div.className = 'option-item';
        div.style.marginBottom = '12px';
        div.onclick = function() { selectHospital(hosp); };
        div.innerHTML = 
          '<div class="option-icon" style="background: #fee2e2;">üè•</div>' +
          '<div class="option-content"><div class="option-title">' + hosp + '</div><div style="font-size: 12px; color: #64748b;">' + cidade + '</div></div>' +
          '<div class="option-check">‚úì</div>';
        list.appendChild(div);
      });
      
      console.log('Hospitais carregados:', cidade);
    }
    
    function selectHospital(nome) {
      console.log('Hospital selecionado:', nome);
      userData.hospital = nome;
      
      // Visual
      const items = document.querySelectorAll('#hospitalList .option-item');
      items.forEach(function(item) { item.classList.remove('selected'); });
      event.currentTarget.classList.add('selected');
      
      // Habilita bot√£o
      document.getElementById('btnHospital').disabled = false;
    }
    
    // REDIRECIONAMENTO - FUN√á√ÉO PRINCIPAL
    function goToResultado() {
      console.log('=== GERANDO ATESTADO ===');
      console.log('Dados:', userData);
      
      try {
        // 1. SALVAR NO LOCALSTORAGE
        localStorage.setItem('atestado_nome', userData.nome || 'Paciente');
        localStorage.setItem('atestado_email', userData.email || '');
        localStorage.setItem('atestado_sintoma', userData.sintoma || 'Geral');
        localStorage.setItem('atestado_dias', userData.dias || 2);
        localStorage.setItem('atestado_hospital', userData.hospital || 'Hospital Regional');
        
        // Assinatura
        if (hasSigned && canvas) {
          localStorage.setItem('atestado_assinatura', canvas.toDataURL());
        }
        
        console.log('Dados salvos!');
        
        // 2. ESCONDER P√ÅGINA
        document.querySelector('.quiz-container').style.display = 'none';
        document.querySelector('.progress-wrapper').style.display = 'none';
        document.querySelector('.header').style.display = 'none';
        
        // 3. MOSTRAR LOADING
        const loading = document.getElementById('loadingScreen');
        loading.style.display = 'flex';
        
        // 4. ANIMA√á√ÉO
        let pct = 0;
        const progressBar = document.getElementById('loadingProgress');
        const percentage = document.getElementById('loadingPercentage');
        const status = document.getElementById('loadingStatus');
        
        const msgs = [
          'Analisando sintomas...',
          'Verificando hist√≥rico...',
          'Calculando repouso...',
          'Selecionando CID...',
          'Gerando documento...',
          'Assinando digitalmente...',
          'Finalizando...',
          'Pronto!'
        ];
        
        const interval = setInterval(function() {
          pct += 12;
          if (pct > 100) pct = 100;
          
          progressBar.style.width = pct + '%';
          percentage.textContent = pct + '%';
          
          const idx = Math.min(Math.floor((pct / 100) * msgs.length), msgs.length - 1);
          status.textContent = msgs[idx];
          
          if (pct >= 100) {
            clearInterval(interval);
            console.log('Redirecionando...');
            
            // REDIRECIONAMENTO
            setTimeout(function() {
              window.location.href = 'resultado.html';
            }, 500);
          }
        }, 350);
        
      } catch (erro) {
        console.error('ERRO:', erro);
        alert('Erro ao gerar atestado. Tentando redirecionar...');
        window.location.href = 'resultado.html';
      }
    }
  </script>
</body>
</html>
